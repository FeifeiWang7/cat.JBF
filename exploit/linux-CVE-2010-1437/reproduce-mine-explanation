Download linux-2.6.34-rc5 from https://github.com/torvalds/linux/archive/v2.6.34-rc5.tar.gz

When compile the kernel, make sure CONFIG_SLUB = Y

keyctl call sys_keyctl, which then calls join_session, which then calls find_keyring_by_name.

The first keyctl created a key.

During the sleep(1) after the first keyctl, kernel detects the keyring is not used, so it uses a task (thread) to cleanup the key, which is key_cleanup in key.c, in which key_destroy in keyring.c is further called. Before key_destroy removes the key name, which means before the write_lock(&keyring_name_lock), let it sleep 1 second, so that the second keyctl begins before the key name is removed.

The second keyctl also calls find_keyring_by_name. Since the name is not removed, it can finds the dead key. Before return and use this key, let it sleep 2 second, so that the key_destroy can resume and return to key_cleanup, and then free the memory of the key. When the freed key is returned and used, memory corruption happens.

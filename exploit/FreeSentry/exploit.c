#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <pthread.h>
regptr(char **p)
{
}

void test1(void *arg)
{
	char **a = ((void **)arg)[0];
	char **b = ((void **)arg)[1];

	printf("in thread 1.\n");

	free(*a);
//	sleep(1);
	*b = NULL; //simulate freesentry
	printf("a is freed. addr a = %d\n", *a);
}

void test2(void *arg)
{
	char **a = ((void **)arg)[0];
	char **b = ((void **)arg)[1];
	
	printf("in thread 2.\n");

	(*b)[0] = 'c';

	printf("b is set to c. addr b = %d\n",*b);
	printf("b[0] = %c\n",*b[0]);
}

int main()
{
	char *a, *b;
	a = malloc(16);
	b = a;

	regptr(&a);
	regptr(&b); //simulate freesentry
	
	void *arg[2] = {&a, &b};
	
	pthread_t thread1, thread2;

	pthread_create(&thread1, NULL, (void *)test1, arg);
	pthread_create(&thread2, NULL, (void *)test2, arg);

	pthread_join(thread1, NULL);
	pthread_join(thread2, NULL);

//	printf("b[0] = %c\n",b[0]);
}
